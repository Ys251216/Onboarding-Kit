<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×¢×¨×›×ª × ×—×™×ª×” ×¨×›×” - Dark Mode Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Chosen Palette: Midnight Professional - Base of Slate-950 for background, Slate-900 for cards, and vibrant Teal-500 for accents and interactive elements. -->
    
    <!-- Application Structure Plan: 
         The app follows the previously designed dashboard structure but with a complete CSS overhaul for Dark Mode.
         - Sidebar: Remains fixed, using Slate-900 to distinguish from the main content.
         - Content Cards: Use Slate-800 with thin Slate-700 borders to maintain depth.
         - Typography: Headings in Slate-50, body text in Slate-400 for hierarchy.
         - Interaction: Maintained the CRUD and AI features with updated styling for inputs and modals to match the dark theme.
    -->

    <!-- Visualization & Content Choices:
         - Progress Chart: Updated colors to Teal-500 (done) and Slate-700 (todo) for high contrast in dark mode.
         - AI Feedback: Loading spinners and modal backgrounds adjusted to be non-obtrusive.
    -->

    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <style>
        body {
            font-family: 'Heebo', sans-serif;
            background-color: #020617; /* Slate-950 */
            color: #94a3b8; /* Slate-400 */
        }
        .nav-item.active {
            background-color: #1e293b; /* Slate-800 */
            border-right: 4px solid #14b8a6; /* Teal-500 */
            color: #2dd4bf; /* Teal-400 */
            font-weight: 700;
        }
        .card-bg {
            background-color: #0f172a; /* Slate-900 */
            border: 1px solid #1e293b; /* Slate-800 */
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            background-color: #1e293b;
            border-color: #334155;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin: auto;
            height: 250px;
        }
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
        }
        .loading-spinner {
            border: 3px solid rgba(255,255,255,0.1);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border-left-color: #2dd4bf;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Custom scrollbar for dark mode */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #020617;
        }
        ::-webkit-scrollbar-thumb {
            background: #1e293b;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #334155;
        }
    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <!-- Sidebar Navigation -->
    <aside class="w-64 bg-slate-900 shadow-2xl z-10 hidden md:flex flex-col border-l border-slate-800">
        <div class="p-6 border-b border-slate-800 flex items-center justify-center">
            <h1 class="text-2xl font-bold text-teal-500">ğŸš€ × ×—×™×ª×” ×¨×›×”</h1>
        </div>
        <nav class="flex-1 overflow-y-auto py-4">
            <ul class="space-y-1">
                <li><button onclick="navigateTo('home')" class="nav-item w-full text-right px-6 py-3 hover:bg-slate-800 flex items-center gap-3 transition-colors active" id="nav-home">ğŸ  ×¨××©×™</button></li>
                <li><button onclick="navigateTo('checklist')" class="nav-item w-full text-right px-6 py-3 hover:bg-slate-800 flex items-center gap-3 transition-colors" id="nav-checklist">âœ… ×¦'×§-×œ×™×¡×˜</button></li>
                <li><button onclick="navigateTo('dictionary')" class="nav-item w-full text-right px-6 py-3 hover:bg-slate-800 flex items-center gap-3 transition-colors" id="nav-dictionary">ğŸ“š ××™×œ×•×Ÿ ××•× ×—×™×</button></li>
                <li><button onclick="navigateTo('contacts')" class="nav-item w-full text-right px-6 py-3 hover:bg-slate-800 flex items-center gap-3 transition-colors" id="nav-contacts">ğŸ‘¥ ×× ×©×™ ×§×©×¨</button></li>
                <li><button onclick="navigateTo('links')" class="nav-item w-full text-right px-6 py-3 hover:bg-slate-800 flex items-center gap-3 transition-colors" id="nav-links">ğŸ”— ×§×™×©×•×¨×™×</button></li>
                <li><button onclick="navigateTo('culture')" class="nav-item w-full text-right px-6 py-3 hover:bg-slate-800 flex items-center gap-3 transition-colors" id="nav-culture">ğŸ’¡ ×ª×¨×‘×•×ª</button></li>
                <li><button onclick="navigateTo('ai-chat')" class="nav-item w-full text-right px-6 py-3 hover:bg-slate-800 flex items-center gap-3 transition-colors text-teal-400 font-medium" id="nav-ai-chat">âœ¨ ××¡×™×™×¢ AI</button></li>
            </ul>
        </nav>
    </aside>

    <!-- Main Content Area -->
    <main class="flex-1 overflow-y-auto p-4 md:p-8 transition-all relative">
        
        <!-- HOME -->
        <section id="home" class="space-y-8 max-w-4xl mx-auto">
            <div class="bg-gradient-to-l from-teal-700 to-teal-950 text-white rounded-2xl p-8 shadow-2xl border border-teal-800/50">
                <h2 class="text-3xl font-bold mb-4">×‘×¨×•×›×™× ×”×‘××™× ×œ×¦×•×•×ª! ğŸ‘‹</h2>
                <p class="text-teal-100 text-lg leading-relaxed">
                    ×›××Ÿ ×ª×•×›×œ×• ×œ××¦×•× ×”×›×œ. ××”××•× ×—×™× ×”××§×¦×•×¢×™×™× ×•×¢×“ ××™ ×¢×•×–×¨ ×›×©×”××§×œ×“×ª × ×©×‘×¨×ª. <br>
                    <span class="text-teal-400 font-bold">×”×›×œ ×‘××¦×‘ ×›×”×” ×—×“×© ×•× ×•×— ×œ×¢×™× ×™×™×.</span>
                </p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="card-bg p-6 rounded-xl shadow-sm card-hover cursor-pointer" onclick="navigateTo('checklist')">
                    <h3 class="text-xl font-bold text-slate-100 mb-2">âœ… × ×™×”×•×œ ××©×™××•×ª</h3>
                    <p class="text-slate-400">×¢×§×•×‘ ××—×¨ ×”×”×ª×§×“××•×ª ×•×”×©×ª××© ×‘-AI ×œ×™×¦×™×¨×ª ××©×™××•×ª ××•×ª×××•×ª ××™×©×™×ª.</p>
                </div>
                <div class="card-bg p-6 rounded-xl shadow-sm card-hover cursor-pointer" onclick="navigateTo('ai-chat')">
                    <h3 class="text-xl font-bold text-slate-100 mb-2">âœ¨ ×©××œ ××ª ×”×¦×•×•×ª ×”×•×•×™×¨×˜×•××œ×™</h3>
                    <p class="text-slate-400">×™×© ×œ×š ×©××œ×”? ×”-AI ×©×œ× ×• ××›×™×¨ ××ª ×”××¨×’×•×Ÿ ×•×™×©××— ×œ×¢×–×•×¨.</p>
                </div>
            </div>
        </section>

        <!-- CHECKLIST -->
        <section id="checklist" class="hidden space-y-6 max-w-5xl mx-auto">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h2 class="text-3xl font-bold text-slate-50">×¦'×§-×œ×™×¡×˜ ×œ×©×‘×•×¢ ×”×¨××©×•×Ÿ</h2>
                    <p class="text-slate-400">× ×”×œ×• ××ª ×”××©×™××•×ª ×©×œ×›× ××• ×¦×¨×• ×—×“×©×•×ª ×‘×¢×–×¨×ª AI.</p>
                </div>
                <div class="flex gap-2">
                    <button onclick="openForm('checklist')" class="bg-teal-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-teal-500 transition-colors text-sm">â• ×”×•×¡×¤×” ×™×“× ×™×ª</button>
                    <button onclick="openAiTaskModal()" class="bg-slate-800 text-teal-400 border border-teal-900/50 px-4 py-2 rounded-lg font-bold hover:bg-slate-700 transition-colors text-sm flex items-center gap-2">âœ¨ ×¦×•×¨ ××©×™××•×ª AI</button>
                </div>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 space-y-4" id="task-list-container"></div>
                <div class="card-bg p-6 rounded-xl shadow-sm flex flex-col items-center">
                    <h3 class="text-lg font-semibold mb-4 text-slate-200">×¡×˜×˜×•×¡ ×”×ª×§×“××•×ª</h3>
                    <div class="chart-container">
                        <canvas id="progressChart"></canvas>
                    </div>
                    <p id="progress-text" class="mt-4 font-bold text-teal-400 text-2xl">0%</p>
                </div>
            </div>
        </section>

        <!-- DICTIONARY -->
        <section id="dictionary" class="hidden space-y-6 max-w-5xl mx-auto">
            <div class="flex justify-between items-center">
                <h2 class="text-3xl font-bold text-slate-50">××™×œ×•×Ÿ ××•× ×—×™×</h2>
                <button onclick="openForm('dictionary')" class="bg-teal-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-teal-500 transition-colors">â• ×”×•×¡×¤×ª ××•× ×—</button>
            </div>
            <input type="text" id="search-term" placeholder="×—×™×¤×•×© ××•× ×—..." class="w-full p-4 rounded-full bg-slate-900 border border-slate-700 text-slate-100 shadow-sm focus:ring-2 focus:ring-teal-500 outline-none" oninput="renderDictionary()">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="terms-grid"></div>
        </section>

        <!-- CONTACTS -->
        <section id="contacts" class="hidden space-y-6 max-w-6xl mx-auto">
            <div class="flex justify-between items-center">
                <h2 class="text-3xl font-bold text-slate-50">××™ × ×’×“ ××™? ×× ×©×™ ×§×©×¨</h2>
                <button onclick="openForm('contacts')" class="bg-teal-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-teal-500 transition-colors">â• ×”×•×¡×¤×ª ××™×© ×§×©×¨</button>
            </div>
            <div class="flex border-b border-slate-800 mb-6">
                <button class="px-6 py-3 text-teal-400 border-b-2 border-teal-500 font-bold focus:outline-none transition-colors" id="tab-internal" onclick="switchContactTab('internal')">ğŸ‘¤ ×¤× ×™××™</button>
                <button class="px-6 py-3 text-slate-500 hover:text-teal-400 focus:outline-none transition-colors" id="tab-gov" onclick="switchContactTab('gov')">ğŸ›ï¸ ×××©×œ×ª×™</button>
            </div>
            <div id="contacts-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </section>

        <!-- LINKS -->
        <section id="links" class="hidden space-y-6 max-w-5xl mx-auto">
            <div class="flex justify-between items-center">
                <h2 class="text-3xl font-bold text-slate-50">×¡×¤×¨×™×™×ª ×§×™×©×•×¨×™×</h2>
                <button onclick="openForm('links')" class="bg-teal-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-teal-500 transition-colors">â• ×”×•×¡×¤×ª ×§×™×©×•×¨</button>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="links-grid"></div>
        </section>

        <!-- CULTURE -->
        <section id="culture" class="hidden space-y-6 max-w-5xl mx-auto">
            <div class="flex justify-between items-center">
                <h2 class="text-3xl font-bold text-slate-50">×ª×¨×‘×•×ª ×”×¦×•×•×ª</h2>
                <button onclick="openForm('culture')" class="bg-teal-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-teal-500 transition-colors">â• ×”×•×¡×¤×ª ×›×œ×œ</button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8" id="culture-grid"></div>
        </section>

        <!-- AI CHAT -->
        <section id="ai-chat" class="hidden space-y-6 max-w-4xl mx-auto h-[80vh] flex flex-col">
            <div class="card-bg p-6 rounded-xl shadow-sm flex-1 flex flex-col overflow-hidden">
                <div class="flex items-center gap-3 mb-4 border-b border-slate-800 pb-4">
                    <div class="bg-teal-900/30 p-2 rounded-full text-xl">âœ¨</div>
                    <div>
                        <h2 class="text-xl font-bold text-slate-50">××¡×™×™×¢ ×”×§×œ×™×˜×” ×”××™×©×™ ×©×œ×š</h2>
                        <p class="text-xs text-slate-500">×©××œ ××•×ª×™ ×”×›×œ ×¢×œ ×”××¨×’×•×Ÿ, × ×”×œ×™× ×•×ª×¨×‘×•×ª ×”×¦×•×•×ª.</p>
                    </div>
                </div>
                <div id="chat-messages" class="flex-1 overflow-y-auto space-y-4 p-2">
                    <div class="bg-slate-800 p-3 rounded-lg max-w-[80%] self-start text-slate-300">
                        <p class="text-sm">×”×™×™! ×× ×™ ×¢×•×–×¨ ×”-AI ×©×œ ×”×¦×•×•×ª. ×‘××” ××•×›×œ ×œ×¢×–×•×¨ ×œ×š ×”×™×•×?</p>
                    </div>
                </div>
                <div class="mt-4 flex gap-2">
                    <input type="text" id="chat-input" placeholder="×›×ª×•×‘ ×›××Ÿ ×©××œ×”..." class="flex-1 p-3 bg-slate-900 border border-slate-700 rounded-xl text-slate-100 outline-none focus:ring-2 focus:ring-teal-500" onkeypress="if(event.key==='Enter') sendMessage()">
                    <button onclick="sendMessage()" id="send-btn" class="bg-teal-600 text-white px-6 py-2 rounded-xl font-bold hover:bg-teal-500">×©×œ×—</button>
                </div>
            </div>
        </section>

    </main>

    <!-- GENERIC MODAL -->
    <div id="modal" class="fixed inset-0 modal-overlay z-50 hidden flex items-center justify-center p-4">
        <div class="bg-slate-900 border border-slate-800 rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden">
            <div class="p-6 border-b border-slate-800 flex justify-between items-center bg-slate-900">
                <h3 id="modal-title" class="text-xl font-bold text-slate-50">×¢×¨×™×›×ª ×¨×©×•××”</h3>
                <button onclick="closeModal()" class="text-slate-500 hover:text-slate-300 text-2xl">&times;</button>
            </div>
            <div id="modal-content" class="p-6 space-y-4 bg-slate-900 text-slate-300"></div>
            <div class="p-6 bg-slate-950 flex justify-end gap-3 border-t border-slate-800">
                <button onclick="closeModal()" class="px-4 py-2 text-slate-400 hover:text-slate-200">×‘×™×˜×•×œ</button>
                <button id="modal-save-btn" class="px-6 py-2 bg-teal-600 text-white rounded-lg font-bold hover:bg-teal-500">×©××™×¨×”</button>
            </div>
        </div>
    </div>

    <!-- AI EXPLAINER MODAL -->
    <div id="ai-modal" class="fixed inset-0 modal-overlay z-[60] hidden flex items-center justify-center p-4">
        <div class="bg-slate-900 border border-slate-800 rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden max-h-[90vh] flex flex-col">
            <div class="p-6 border-b border-slate-800 flex justify-between items-center bg-teal-900/20">
                <h3 id="ai-modal-title" class="text-xl font-bold text-teal-400 flex items-center gap-2">âœ¨ ×”×¡×‘×¨ ×—×›×</h3>
                <button onclick="closeAiModal()" class="text-slate-500 hover:text-slate-300 text-2xl">&times;</button>
            </div>
            <div id="ai-modal-content" class="p-6 overflow-y-auto space-y-4 text-slate-300 leading-relaxed bg-slate-900"></div>
            <div class="p-6 border-t border-slate-800 flex justify-end bg-slate-950">
                <button onclick="closeAiModal()" class="px-6 py-2 bg-teal-600 text-white rounded-lg font-bold">×”×‘× ×ª×™, ×ª×•×“×”!</button>
            </div>
        </div>
    </div>

    <script>
        const apiKey = "";
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'onboarding-kit-dark';

        // --- DATA STATE ---
        let checklistData = [
            { id: 1, text: "×”×’×“×¨×ª ×©× ××©×ª××© ×•×¡×™×¡××”", done: false },
            { id: 2, text: "×”×¦×˜×¨×¤×•×ª ×œ×¢×¨×•×¦×™ ×”-Slack", done: false },
            { id: 3, text: "×¤×’×™×©×ª ×”×›×¨×•×ª 1:1 ×¢× ×”×× ×”×œ", done: false }
        ];

        let termsData = [
            { id: 1, term: "KPI", definition: "××“×“×™ ×‘×™×¦×•×¢ ××¨×›×–×™×™× ×œ×‘×—×™× ×ª ×”×¦×œ×—×”." },
            { id: 2, term: "×•×¢×“×ª ×”×™×’×•×™", definition: "×”×¤×•×¨×•× ×”×‘×›×™×¨ ×©××§×‘×œ ×”×—×œ×˜×•×ª ××¡×˜×¨×˜×’×™×•×ª." }
        ];

        let contactsData = [
            { id: 1, type: 'internal', name: "×™×©×¨××œ ×™×©×¨××œ×™", role: "×× ×”×œ ×¦×•×•×ª", purpose: "×©××œ×•×ª ××§×¦×•×¢×™×•×ª", contact: "050-0000000", icon: "ğŸ‘‘" },
            { id: 2, type: 'gov', name: "××©×¨×“ ×”××•×¦×¨", role: "×¨×¤×¨× ×˜", purpose: "××™×©×•×¨×™ ×ª×§×¦×™×‘", contact: "office@mof.gov.il", icon: "ğŸ’°" }
        ];

        let linksData = [
            { id: 1, title: "×¤×•×¨×˜×œ ×”××¨×’×•×Ÿ", desc: "×“×™×•×•×— ×©×¢×•×ª ×•×˜×¤×¡×™×", url: "https://portal.example.com", color: "bg-slate-800/50 border-blue-500/30" },
            { id: 2, title: "×ª×™×§×™×™×ª ×¤×¨×•×™×§×˜", desc: "××¡××›×™× ××§×¦×•×¢×™×™×", url: "https://drive.google.com", color: "bg-slate-800/50 border-emerald-500/30" }
        ];

        let cultureData = [
            { id: 1, title: "××¨×•×—×ª ×¦×”×¨×™×™×", desc: "×™×•×¦××™× ×™×—×“ ×‘-13:00", icon: "ğŸ”" },
            { id: 2, title: "×©×§×™×¤×•×ª", desc: "××©×ª×¤×™× ×§×©×™×™× ××•×§×“×", icon: "ğŸ‘" }
        ];

        let currentSection = 'home';
        let contactType = 'internal';
        let editId = null;
        let chartInstance = null;

        // --- GEMINI API INTEGRATION ---
        async function callGemini(prompt, systemInstruction = "You are a helpful onboarding assistant. Respond in Hebrew. Use dark mode aesthetic terminology if appropriate.") {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: { parts: [{ text: systemInstruction }] }
            };

            for (let i = 0; i < 5; i++) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) throw new Error('API Error');
                    const result = await response.json();
                    return result.candidates?.[0]?.content?.parts?.[0]?.text;
                } catch (e) {
                    await new Promise(r => setTimeout(r, Math.pow(2, i) * 1000));
                }
            }
            throw new Error('×©×™×¨×•×ª ×”-AI ×œ× ×–××™×Ÿ ×›×¨×’×¢.');
        }

        // --- NAVIGATION ---
        function navigateTo(sectionId) {
            document.querySelectorAll('main > section').forEach(s => s.classList.add('hidden'));
            const target = document.getElementById(sectionId);
            if (target) target.classList.remove('hidden');
            
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            const activeNav = document.getElementById(`nav-${sectionId}`);
            if (activeNav) activeNav.classList.add('active');
            
            currentSection = sectionId;
            renderAll();
        }

        function renderAll() {
            if (currentSection === 'checklist') renderChecklist();
            if (currentSection === 'dictionary') renderDictionary();
            if (currentSection === 'contacts') renderContacts();
            if (currentSection === 'links') renderLinks();
            if (currentSection === 'culture') renderCulture();
        }

        // --- CHECKLIST ---
        function renderChecklist() {
            const container = document.getElementById('task-list-container');
            if (!container) return;
            container.innerHTML = checklistData.map(item => `
                <div class="p-4 rounded-lg border flex items-center justify-between transition-all ${item.done ? 'bg-teal-900/20 border-teal-800' : 'bg-slate-900 border-slate-800 shadow-sm'}">
                    <div class="flex items-center gap-4 flex-1 cursor-pointer" onclick="toggleTask(${item.id})">
                        <div class="w-6 h-6 rounded-full border-2 flex items-center justify-center ${item.done ? 'bg-teal-500 border-teal-500 text-slate-900' : 'border-slate-700'}">
                            ${item.done ? 'âœ”' : ''}
                        </div>
                        <span class="${item.done ? 'line-through text-slate-600' : 'font-medium text-slate-200'}">${item.text}</span>
                    </div>
                    <div class="flex gap-3">
                        <button onclick="openForm('checklist', ${item.id})" class="text-slate-500 hover:text-teal-400">âœï¸</button>
                        <button onclick="deleteItem('checklist', ${item.id})" class="text-slate-500 hover:text-red-400">ğŸ—‘ï¸</button>
                    </div>
                </div>
            `).join('');
            updateChart();
        }

        function toggleTask(id) {
            const t = checklistData.find(x => x.id === id);
            if (t) t.done = !t.done;
            renderChecklist();
        }

        function updateChart() {
            const chartCanvas = document.getElementById('progressChart');
            if (!chartCanvas) return;
            const done = checklistData.filter(x => x.done).length;
            const total = checklistData.length || 1;
            const perc = Math.round((done / total) * 100);
            document.getElementById('progress-text').innerText = `${perc}%`;
            
            if (chartInstance) chartInstance.destroy();
            chartInstance = new Chart(chartCanvas.getContext('2d'), {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [done, total - done],
                        backgroundColor: ['#14b8a6', '#1e293b'],
                        borderWidth: 0
                    }]
                },
                options: { cutout: '80%', maintainAspectRatio: false, plugins: { tooltip: { enabled: false } } }
            });
        }

        // AI TASK MODAL
        async function openAiTaskModal() {
            const modal = document.getElementById('modal');
            const content = document.getElementById('modal-content');
            document.getElementById('modal-title').innerText = 'âœ¨ ××—×•×œ×œ ××©×™××•×ª AI';
            content.innerHTML = `
                <p class="text-sm text-slate-400 mb-2">×”×–×Ÿ ××ª ×”×ª×¤×§×™×“ ×”×—×“×© ×œ×§×‘×œ×ª ×”×¦×¢×•×ª:</p>
                <input type="text" id="ai-role-input" placeholder="×œ××©×œ: ××¤×ª×— Frontend" class="w-full p-3 bg-slate-800 border border-slate-700 rounded-lg mb-4 text-slate-100">
                <div id="ai-loading" class="hidden flex items-center gap-2 text-teal-400"><div class="loading-spinner"></div> ××¢×‘×“...</div>
                <div id="ai-results" class="space-y-2 max-h-48 overflow-y-auto"></div>
            `;
            const saveBtn = document.getElementById('modal-save-btn');
            saveBtn.innerText = '×¦×•×¨ ×”×¦×¢×•×ª';
            saveBtn.onclick = async () => {
                const role = document.getElementById('ai-role-input').value;
                if(!role) return;
                const loading = document.getElementById('ai-loading');
                const results = document.getElementById('ai-results');
                loading.classList.remove('hidden');
                saveBtn.disabled = true;
                try {
                    const res = await callGemini(`×”×¦×¢ 5 ××©×™××•×ª ×§×œ×™×˜×” ×œ×ª×¤×§×™×“: ${role}. ×©×•×¨×•×ª ×‘×•×“×“×•×ª ×œ×œ× ××¡×¤×•×¨.`);
                    const tasks = res.split('\n').filter(t => t.trim().length > 2);
                    results.innerHTML = tasks.map((t, idx) => `
                        <div class="flex items-center gap-2 bg-slate-800 p-2 rounded border border-slate-700">
                            <input type="checkbox" id="ai-t-${idx}" value="${t}" checked class="accent-teal-500">
                            <label for="ai-t-${idx}" class="text-xs text-slate-300">${t}</label>
                        </div>
                    `).join('');
                    saveBtn.innerText = '×”×•×¡×£ × ×‘×—×¨×•×ª';
                    saveBtn.onclick = () => {
                        tasks.forEach((t, idx) => {
                            if(document.getElementById(`ai-t-${idx}`).checked) checklistData.push({ id: Date.now() + idx, text: t, done: false });
                        });
                        closeModal();
                        renderChecklist();
                    };
                } catch (e) { results.innerHTML = `<p class="text-red-400 text-xs">${e.message}</p>`; }
                finally { loading.classList.add('hidden'); saveBtn.disabled = false; }
            };
            modal.classList.remove('hidden');
        }

        // --- DICTIONARY ---
        function renderDictionary() {
            const search = document.getElementById('search-term').value.toLowerCase();
            const grid = document.getElementById('terms-grid');
            if (!grid) return;
            grid.innerHTML = termsData.filter(t => t.term.toLowerCase().includes(search) || t.definition.toLowerCase().includes(search)).map(t => `
                <div class="card-bg p-5 rounded-xl relative group card-hover">
                    <div class="flex justify-between items-start">
                        <h4 class="text-teal-400 font-bold text-lg">${t.term}</h4>
                        <button onclick="explainTerm('${t.term}')" class="text-xs bg-teal-900/30 text-teal-400 px-2 py-1 rounded-full hover:bg-teal-900/50">âœ¨ AI</button>
                    </div>
                    <p class="text-slate-400 text-sm mt-1 leading-relaxed">${t.definition}</p>
                    <div class="mt-4 flex gap-3 opacity-0 group-hover:opacity-100 transition-opacity">
                        <button onclick="openForm('dictionary', ${t.id})" class="text-xs text-slate-500 hover:text-teal-400">âœï¸</button>
                        <button onclick="deleteItem('dictionary', ${t.id})" class="text-xs text-slate-500 hover:text-red-400">ğŸ—‘ï¸</button>
                    </div>
                </div>
            `).join('');
        }

        async function explainTerm(term) {
            const modal = document.getElementById('ai-modal');
            const content = document.getElementById('ai-modal-content');
            document.getElementById('ai-modal-title').innerText = `âœ¨ ××” ×–×” ${term}?`;
            content.innerHTML = '<div class="flex items-center gap-3 text-teal-400"><div class="loading-spinner"></div> ×× ×ª×— × ×ª×•× ×™×...</div>';
            modal.classList.remove('hidden');
            try {
                const res = await callGemini(`×”×¡×‘×¨ ×œ×¢×•×‘×“ ×—×“×© ××ª ×”××•×©×’ "${term}" ×‘×¤×™×¨×•×˜. ×”×©×ª××© ×‘××‘× ×” Markdown.`);
                content.innerHTML = formatMarkdown(res);
            } catch (e) { content.innerHTML = `<p class="text-red-400">${e.message}</p>`; }
        }

        // --- CONTACTS ---
        function renderContacts() {
            const grid = document.getElementById('contacts-grid');
            if (!grid) return;
            grid.innerHTML = contactsData.filter(c => c.type === contactType).map(c => `
                <div class="card-bg p-6 rounded-xl text-center relative group card-hover">
                    <div class="text-4xl mb-3">${c.icon}</div>
                    <h3 class="font-bold text-slate-100 text-lg">${c.name}</h3>
                    <div class="text-xs text-teal-400 font-bold mb-2 uppercase tracking-wider">${c.role}</div>
                    <p class="text-xs text-slate-500 mb-4 h-8">${c.purpose}</p>
                    <div class="text-sm font-medium text-slate-300 bg-slate-800 py-2 rounded-lg">${c.contact}</div>
                    <div class="absolute top-4 left-4 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                        <button onclick="openForm('contacts', ${c.id})" class="text-slate-500 hover:text-teal-400">âœï¸</button>
                        <button onclick="deleteItem('contacts', ${c.id})" class="text-slate-500 hover:text-red-400">ğŸ—‘ï¸</button>
                    </div>
                </div>
            `).join('');
        }

        // --- LINKS ---
        function renderLinks() {
            const grid = document.getElementById('links-grid');
            if (!grid) return;
            grid.innerHTML = linksData.map(l => `
                <div class="${l.color} p-6 rounded-xl border-r-4 relative group cursor-pointer hover:bg-slate-800/80 transition-all border-slate-700/50" onclick="if('${l.url}') window.open('${l.url}', '_blank')">
                    <h3 class="font-bold text-slate-100 text-lg">${l.title} â†—</h3>
                    <p class="text-slate-400 text-xs mt-2 leading-relaxed">${l.desc}</p>
                    <div class="absolute top-4 left-4 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                        <button onclick="event.stopPropagation(); openForm('links', ${l.id})" class="p-1 hover:bg-slate-700 rounded">âœï¸</button>
                        <button onclick="event.stopPropagation(); deleteItem('links', ${l.id})" class="p-1 hover:bg-slate-700 rounded">ğŸ—‘ï¸</button>
                    </div>
                </div>
            `).join('');
        }

        // --- CULTURE ---
        function renderCulture() {
            const grid = document.getElementById('culture-grid');
            if (!grid) return;
            grid.innerHTML = cultureData.map(c => `
                <div class="flex items-start gap-4 p-5 card-bg rounded-xl relative group card-hover">
                    <div class="bg-teal-900/20 p-3 rounded-xl text-3xl shadow-inner">${c.icon}</div>
                    <div class="flex-1">
                        <h3 class="font-bold text-slate-100 text-lg">${c.title}</h3>
                        <p class="text-slate-500 text-sm mt-1 leading-relaxed">${c.desc}</p>
                    </div>
                    <div class="absolute top-4 left-4 flex gap-3 opacity-0 group-hover:opacity-100 transition-opacity">
                        <button onclick="openForm('culture', ${c.id})" class="text-slate-500 hover:text-teal-400">âœï¸</button>
                        <button onclick="deleteItem('culture', ${c.id})" class="text-slate-500 hover:text-red-400">ğŸ—‘ï¸</button>
                    </div>
                </div>
            `).join('');
        }

        // --- AI CHAT ---
        async function sendMessage() {
            const input = document.getElementById('chat-input');
            const msg = input.value.trim();
            if(!msg) return;
            const chatBox = document.getElementById('chat-messages');
            chatBox.innerHTML += `<div class="bg-teal-600 text-slate-950 p-3 rounded-2xl rounded-tr-none max-w-[85%] self-end mr-auto font-medium"><p class="text-sm">${msg}</p></div>`;
            input.value = '';
            chatBox.scrollTop = chatBox.scrollHeight;
            const lid = 'ai-load-' + Date.now();
            chatBox.innerHTML += `<div id="${lid}" class="bg-slate-800 p-3 rounded-2xl rounded-tl-none max-w-[85%] self-start flex gap-2"><div class="loading-spinner"></div></div>`;
            try {
                const ctx = `Context: Our onboarding kit includes terms like: ${termsData.map(t=>t.term).join(', ')}. Rules: ${cultureData.map(c=>c.title).join(', ')}.`;
                const res = await callGemini(`${ctx}\n\nUser Question: ${msg}`);
                document.getElementById(lid).innerHTML = `<p class="text-sm text-slate-200">${res}</p>`;
            } catch (e) { document.getElementById(lid).innerHTML = `<p class="text-xs text-red-400">×©×’×™××”: ${e.message}</p>`; }
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        // --- MODAL & FORMS ---
        function openForm(section, id = null) {
            editId = id;
            const modal = document.getElementById('modal');
            const content = document.getElementById('modal-content');
            const title = document.getElementById('modal-title');
            title.innerText = id ? '×¢×¨×™×›×ª ×¨×©×•××”' : '×”×•×¡×¤×ª ×¨×©×•××”';
            const arr = getDataArray(section);
            const data = id ? arr.find(x => x.id === id) : {};
            
            const inputClass = "w-full p-3 bg-slate-800 border border-slate-700 rounded-lg text-slate-100 focus:ring-2 focus:ring-teal-500 outline-none transition-all";
            
            if (section === 'checklist') content.innerHTML = `<input type="text" id="f-text" placeholder="×ª×™××•×¨ ×”××©×™××”" class="${inputClass}" value="${data.text || ''}">`;
            else if (section === 'dictionary') content.innerHTML = `<input type="text" id="f-term" placeholder="××•× ×—" class="${inputClass}" value="${data.term || ''}"><textarea id="f-def" placeholder="×”×’×“×¨×”" class="${inputClass} h-24">${data.definition || ''}</textarea>`;
            else if (section === 'contacts') content.innerHTML = `
                <select id="f-type" class="${inputClass}"><option value="internal" ${data.type==='internal'?'selected':''}>×¤× ×™××™</option><option value="gov" ${data.type==='gov'?'selected':''}>×××©×œ×ª×™</option></select>
                <input type="text" id="f-name" placeholder="×©×" class="${inputClass}" value="${data.name || ''}">
                <input type="text" id="f-role" placeholder="×ª×¤×§×™×“" class="${inputClass}" value="${data.role || ''}">
                <input type="text" id="f-purpose" placeholder="××˜×¨×”" class="${inputClass}" value="${data.purpose || ''}">
                <input type="text" id="f-contact" placeholder="×¤×¨×˜×™ ×§×©×¨" class="${inputClass}" value="${data.contact || ''}">
                <input type="text" id="f-icon" placeholder="××™×™×§×•×Ÿ (Emoji)" class="${inputClass}" value="${data.icon || 'ğŸ‘¤'}">`;
            else if (section === 'links') content.innerHTML = `
                <input type="text" id="f-title" placeholder="×›×•×ª×¨×ª" class="${inputClass}" value="${data.title || ''}">
                <input type="text" id="f-desc" placeholder="×ª×™××•×¨" class="${inputClass}" value="${data.desc || ''}">
                <input type="text" id="f-url" placeholder="URL" class="${inputClass}" value="${data.url || ''}">
                <select id="f-color" class="${inputClass}">
                    <option value="bg-slate-800 border-blue-500/30" ${data.color?.includes('blue')?'selected':''}>×›×—×•×œ</option>
                    <option value="bg-slate-800 border-emerald-500/30" ${data.color?.includes('emerald')?'selected':''}>×™×¨×•×§</option>
                    <option value="bg-slate-800 border-purple-500/30" ${data.color?.includes('purple')?'selected':''}>×¡×’×•×œ</option>
                </select>`;
            else if (section === 'culture') content.innerHTML = `
                <input type="text" id="f-title" placeholder="×›×•×ª×¨×ª" class="${inputClass}" value="${data.title || ''}">
                <input type="text" id="f-desc" placeholder="×ª×™××•×¨" class="${inputClass}" value="${data.desc || ''}">
                <input type="text" id="f-icon" placeholder="××™×™×§×•×Ÿ (Emoji)" class="${inputClass}" value="${data.icon || 'ğŸ’¡'}">`;
            
            document.getElementById('modal-save-btn').onclick = () => saveForm(section);
            modal.classList.remove('hidden');
        }

        function saveForm(section) {
            let arr = getDataArray(section);
            let newItem = { id: editId || Date.now() };
            if (section === 'checklist') newItem.text = document.getElementById('f-text').value;
            if (section === 'dictionary') { newItem.term = document.getElementById('f-term').value; newItem.definition = document.getElementById('f-def').value; }
            if (section === 'contacts') { newItem.type = document.getElementById('f-type').value; newItem.name = document.getElementById('f-name').value; newItem.role = document.getElementById('f-role').value; newItem.purpose = document.getElementById('f-purpose').value; newItem.contact = document.getElementById('f-contact').value; newItem.icon = document.getElementById('f-icon').value; }
            if (section === 'links') { newItem.title = document.getElementById('f-title').value; newItem.desc = document.getElementById('f-desc').value; newItem.url = document.getElementById('f-url').value; newItem.color = document.getElementById('f-color').value; }
            if (section === 'culture') { newItem.title = document.getElementById('f-title').value; newItem.desc = document.getElementById('f-desc').value; newItem.icon = document.getElementById('f-icon').value; }

            if (editId) arr[arr.findIndex(x => x.id === editId)] = { ...newItem };
            else { if (section === 'checklist') newItem.done = false; arr.push(newItem); }
            closeModal(); renderAll();
        }

        function deleteItem(section, id) {
            if (!confirm('×œ××—×•×§ ×¨×©×•××” ×–×•?')) return;
            if (section === 'checklist') checklistData = checklistData.filter(x => x.id !== id);
            else if (section === 'dictionary') termsData = termsData.filter(x => x.id !== id);
            else if (section === 'contacts') contactsData = contactsData.filter(x => x.id !== id);
            else if (section === 'links') linksData = linksData.filter(x => x.id !== id);
            else if (section === 'culture') cultureData = cultureData.filter(x => x.id !== id);
            renderAll();
        }

        function getDataArray(s) {
            if (s === 'checklist') return checklistData;
            if (s === 'dictionary') return termsData;
            if (s === 'contacts') return contactsData;
            if (s === 'links') return linksData;
            if (s === 'culture') return cultureData;
            return [];
        }

        function closeModal() { document.getElementById('modal').classList.add('hidden'); }
        function closeAiModal() { document.getElementById('ai-modal').classList.add('hidden'); }
        function formatMarkdown(text) { return text.replace(/\*\*(.*?)\*\*/g, '<strong class="text-teal-400">$1</strong>').replace(/\n/g, '<br>'); }
        function switchContactTab(type) { 
            contactType = type; 
            document.getElementById('tab-internal').className = type === 'internal' ? 'px-6 py-3 text-teal-400 border-b-2 border-teal-500 font-bold focus:outline-none transition-colors' : 'px-6 py-3 text-slate-500 hover:text-teal-400 focus:outline-none transition-colors';
            document.getElementById('tab-gov').className = type === 'gov' ? 'px-6 py-3 text-teal-400 border-b-2 border-teal-500 font-bold focus:outline-none transition-colors' : 'px-6 py-3 text-slate-500 hover:text-teal-400 focus:outline-none transition-colors';
            renderContacts(); 
        }

        window.onload = () => navigateTo('home');
    </script>
<script type="module">
  // 1. ×™×™×‘×•× ×”×¡×¤×¨×™×•×ª - ××œ ×ª×™×’×¢ ×‘×–×”, ×–×” ×¤×©×•×˜ ××‘×™× ××ª ×”×›×œ×™× ××”××™× ×˜×¨× ×˜
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

  // 2. ×›××Ÿ ×ª×“×‘×™×§ ××ª ×”-Config ×©×”×¢×ª×§×ª ×-Firebase (×‘××§×•× ××” ×©×›×ª×•×‘ ×›××Ÿ ×œ××˜×”)
  const firebaseConfig = {
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-analytics.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyDHMgzo-yQ_UGkAXdBPzkJjB7uCGG9_nBs",
    authDomain: "onboarding-kit-60190.firebaseapp.com",
    projectId: "onboarding-kit-60190",
    storageBucket: "onboarding-kit-60190.firebasestorage.app",
    messagingSenderId: "515390708221",
    appId: "1:515390708221:web:a828f2289fe2cfe9602194",
    measurementId: "G-J1PXK67117"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  };

  // 3. ×—×™×‘×•×¨ ×”××¢×¨×›×ª
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // 4. ×¤×•× ×§×¦×™×” ×©×ª×©××•×¨ ××ª ××” ×©×›×ª×‘×ª (× ×©×ª××© ×‘×” ×¢×•×“ ×¨×’×¢)
  async function saveDataToFirebase() {
    // × × ×™×— ×©×™×© ×œ×š ×ª×™×‘×ª ×˜×§×¡×˜ ×¢× id="myInput"
    const textToSave = document.getElementById('myInput').value; 

    try {
      // ×©××™×¨×” ×œ×ª×•×š "××’×™×¨×”" ×©×§×¨×× ×• ×œ×” notes, ×ª×—×ª ×”×©× myNote
      await setDoc(doc(db, "notes", "myNote"), {
        content: textToSave,
        time: new Date()
      });
      alert("× ×©××¨ ×‘×‘×¡×™×¡ ×”× ×ª×•× ×™×!");
    } catch (error) {
      console.error("×©×’×™××”:", error);
    }
  }

  // ×—×•×‘×”: ×—×©×™×¤×ª ×”×¤×•× ×§×¦×™×” ×›×“×™ ×©×”×›×¤×ª×•×¨ ×‘-HTML ×™×–×”×” ××•×ª×”
  window.saveDataToFirebase = saveDataToFirebase;
</script>
</body>

</html>
